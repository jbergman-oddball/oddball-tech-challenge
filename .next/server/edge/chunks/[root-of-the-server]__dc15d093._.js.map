{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 23, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/src/middleware.ts"],"sourcesContent":["\nimport { NextResponse } from 'next/server';\nimport type { NextRequest } from 'next/server';\n\nexport const config = {\n  // The matcher is configured to run middleware on all routes except for\n  // public assets, the login page, the signup page, and the auth API routes.\n  // This ensures that authentication is checked for all protected pages.\n  matcher: [\n    '/((?!api/auth/verify|login|signup|_next/static|_next/image|favicon.ico).*)',\n  ],\n};\n\nexport async function middleware(request: NextRequest) {\n  const sessionCookieName = 'codealchemist-session';\n  const cookie = request.cookies.get(sessionCookieName);\n\n  // The absolute URL is required for the fetch request to the API route.\n  const verifyUrl = new URL('/api/auth/verify', request.url);\n\n  // If there's no session cookie, redirect to the login page immediately.\n  if (!cookie) {\n    return NextResponse.redirect(new URL('/login', request.url));\n  }\n\n  try {\n    // Call the internal API route to verify the session cookie.\n    // We pass the cookie value in the headers for verification.\n    const response = await fetch(verifyUrl.toString(), {\n      headers: {\n        Cookie: `${sessionCookieName}=${cookie.value}`,\n      },\n    });\n\n    const { isAuthenticated } = await response.json();\n\n    // If the session is not valid, redirect to the login page.\n    if (!isAuthenticated) {\n      return NextResponse.redirect(new URL('/login', request.url));\n    }\n\n    // If the session is valid, allow the request to proceed.\n    return NextResponse.next();\n  } catch (error) {\n    console.error('Middleware verification error:', error);\n    // In case of an error during verification, it's safer to redirect to login.\n    return NextResponse.redirect(new URL('/login', request.url));\n  }\n}\n"],"names":[],"mappings":";;;;AACA;AAAA;;AAGO,MAAM,SAAS;IACpB,uEAAuE;IACvE,2EAA2E;IAC3E,uEAAuE;IACvE,SAAS;QACP;KACD;AACH;AAEO,eAAe,WAAW,OAAoB;IACnD,MAAM,oBAAoB;IAC1B,MAAM,SAAS,QAAQ,OAAO,CAAC,GAAG,CAAC;IAEnC,uEAAuE;IACvE,MAAM,YAAY,IAAI,IAAI,oBAAoB,QAAQ,GAAG;IAEzD,wEAAwE;IACxE,IAAI,CAAC,QAAQ;QACX,OAAO,6LAAA,CAAA,eAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,UAAU,QAAQ,GAAG;IAC5D;IAEA,IAAI;QACF,4DAA4D;QAC5D,4DAA4D;QAC5D,MAAM,WAAW,MAAM,MAAM,UAAU,QAAQ,IAAI;YACjD,SAAS;gBACP,QAAQ,GAAG,kBAAkB,CAAC,EAAE,OAAO,KAAK,EAAE;YAChD;QACF;QAEA,MAAM,EAAE,eAAe,EAAE,GAAG,MAAM,SAAS,IAAI;QAE/C,2DAA2D;QAC3D,IAAI,CAAC,iBAAiB;YACpB,OAAO,6LAAA,CAAA,eAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,UAAU,QAAQ,GAAG;QAC5D;QAEA,yDAAyD;QACzD,OAAO,6LAAA,CAAA,eAAY,CAAC,IAAI;IAC1B,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,kCAAkC;QAChD,4EAA4E;QAC5E,OAAO,6LAAA,CAAA,eAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,UAAU,QAAQ,GAAG;IAC5D;AACF"}}]
}